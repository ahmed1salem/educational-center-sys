<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-content .page {
            display: none; /* Hide all pages by default */
        }
        .main-content .page.active {
            display: block; /* Show only the active page */
        }
        .sidebar {
            height: 100vh;
            position: sticky;
            top: 0;
            background-color: #343a40;
            color: white;
        }
        .sidebar .nav-link {
            color: #adb5bd;
            cursor: pointer;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: #495057;
        }
        .stat-card {
            border: none;
            border-radius: 0.5rem;
            color: white;
        }
        .card-icon {
            font-size: 3rem;
            opacity: 0.7;
        }
        #receipt-modal-content {
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar p-3">
            <h4 class="text-center mb-4">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ²</h4>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" onclick="showPage('dashboard')">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('students')">ğŸ§‘â€ğŸ“ Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('attendance')">âœ… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„ØºÙŠØ§Ø¨</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('finance')">ğŸ’µ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</a>
                </li>
                 <li class="nav-item">
                    <a class="nav-link text-danger" onclick="clearData()">ğŸ—‘ï¸ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
                </li>
            </ul>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 pt-4 main-content">
            
            <div id="dashboard" class="page active">
                <h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card stat-card bg-primary p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø§Ø¨</h5>
                                    <h2 id="total-students-stat">0</h2>
                                </div>
                                <div class="card-icon">ğŸ§‘â€ğŸ“</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card bg-success p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h5>
                                    <h2 id="total-revenue-stat">0</h2>
                                </div>
                                <div class="card-icon">ğŸ’µ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="students" class="page">
                <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                <div class="card p-3 mb-4">
                    <h5>Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨ Ø¬Ø¯ÙŠØ¯</h5>
                    <form id="add-student-form">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="name" class="form-label">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                                <input type="text" id="name" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="stage" class="form-label">Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ©</label>
                                <input type="text" id="stage" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="parentPhone" class="form-label">Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</label>
                                <input type="tel" id="parentPhone" class="form-control" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨</button>
                    </form>
                </div>
                <div class="card p-3">
                    <h5>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h5>
                    <input type="text" id="search-student" class="form-control mb-3" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯...">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„ÙƒÙˆØ¯ (Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯)</th>
                                <th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th>
                                <th>Ù‡Ø§ØªÙ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                                <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                           </tbody>
                    </table>
                </div>
            </div>

            <div id="attendance" class="page">
                <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± (Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯)</h3>
                <div class="card p-3">
                    <p>Ù‚Ù… Ø¨ØªÙˆØ¬ÙŠÙ‡ Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù†Ø­Ùˆ Ø­Ù‚Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø¯Ù†Ø§Ù‡. Ø³ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø¶ÙˆØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</p>
                    <input type="text" id="barcode-input" class="form-control form-control-lg" placeholder="ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...">
                    <div id="attendance-feedback" class="mt-3"></div>
                </div>
            </div>

            <div id="finance" class="page">
                <h3>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©</h3>
                <div class="card p-3">
                     <h5>ØªØ³Ø¬ÙŠÙ„ Ø¯ÙØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©</h5>
                     <form id="add-payment-form">
                         <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="payment-student-id" class="form-label">ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨</label>
                                <input type="text" class="form-control" id="payment-student-id" required>
                            </div>
                             <div class="col-md-6 mb-3">
                                <label for="payment-amount" class="form-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
                                <input type="number" class="form-control" id="payment-amount" required>
                            </div>
                         </div>
                         <button type="submit" class="btn btn-success">ØªØ³Ø¬ÙŠÙ„ ÙˆØ·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø¥ÙŠØµØ§Ù„</button>
                     </form>
                </div>
            </div>

        </main>
    </div>
</div>

<div class="modal fade" id="receiptModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Ø¥ÙŠØµØ§Ù„ Ø§Ø³ØªÙ„Ø§Ù…</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="receipt-modal-content">
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
        <button type="button" class="btn btn-primary" onclick="window.print()">Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// =================================================================
// DATABASE SIMULATION (using browser's localStorage)
// =================================================================
const DB = {
    // Load data from localStorage or initialize if not present
    getStudents: () => JSON.parse(localStorage.getItem('students') || '[]'),
    saveStudents: (students) => localStorage.setItem('students', JSON.stringify(students)),
    getPayments: () => JSON.parse(localStorage.getItem('payments') || '[]'),
    savePayments: (payments) => localStorage.setItem('payments', JSON.stringify(payments)),
};

// =================================================================
// UI (User Interface) LOGIC
// =================================================================
function showPage(pageId) {
    // Hide all pages
    document.querySelectorAll('.main-content .page').forEach(page => {
        page.style.display = 'none';
    });
    // Show the requested page
    document.getElementById(pageId).style.display = 'block';

    // Update active link in sidebar
     document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.classList.remove('active');
    });
    document.querySelector(`.sidebar .nav-link[onclick="showPage('${pageId}')"]`).classList.add('active');
    
    // Refresh data when showing a page
    if (pageId === 'students') renderStudentsTable();
    if (pageId === 'dashboard') renderDashboard();
}

function renderDashboard() {
    const students = DB.getStudents();
    const payments = DB.getPayments();
    
    document.getElementById('total-students-stat').innerText = students.length;
    
    const totalRevenue = payments.reduce((sum, payment) => sum + payment.amount, 0);
    document.getElementById('total-revenue-stat').innerText = `${totalRevenue} Ø¬Ù†ÙŠÙ‡`;
}

function renderStudentsTable(filter = '') {
    const students = DB.getStudents();
    const tableBody = document.getElementById('students-table-body');
    tableBody.innerHTML = ''; // Clear existing table
    
    const filteredStudents = students.filter(student => 
        student.name.toLowerCase().includes(filter.toLowerCase()) || 
        student.id.toLowerCase().includes(filter.toLowerCase())
    );

    if (filteredStudents.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5" class="text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø·Ù„Ø§Ø¨ Ù…Ø³Ø¬Ù„ÙˆÙ†.</td></tr>';
        return;
    }

    filteredStudents.forEach(student => {
        const row = `
            <tr>
                <td>${student.name}</td>
                <td>${student.id}</td>
                <td>${student.stage}</td>
                <td>${student.parentPhone}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.id}')">Ø­Ø°Ù</button>
                </td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}

function clearData() {
    if (confirm('ØªØ­Ø°ÙŠØ±! Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
        localStorage.removeItem('students');
        localStorage.removeItem('payments');
        alert('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
        renderDashboard();
        renderStudentsTable();
    }
}

// =================================================================
// BUSINESS LOGIC
// =================================================================
function addStudent(event) {
    event.preventDefault();
    const name = document.getElementById('name').value;
    const stage = document.getElementById('stage').value;
    const parentPhone = document.getElementById('parentPhone').value;

    // Create a unique ID for student (serves as barcode)
    const studentId = `STU-${Date.now()}`;

    const newStudent = {
        id: studentId,
        name,
        stage,
        parentPhone
    };

    const students = DB.getStudents();
    students.push(newStudent);
    DB.saveStudents(students);

    alert(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ (Ù„Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯) Ù‡Ùˆ: ${studentId}`);
    document.getElementById('add-student-form').reset();
    renderStudentsTable();
    renderDashboard();
}

function deleteStudent(studentId) {
    if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨ ØµØ§Ø­Ø¨ Ø§Ù„ÙƒÙˆØ¯ ${studentId}ØŸ`)) {
        let students = DB.getStudents();
        students = students.filter(student => student.id !== studentId);
        DB.saveStudents(students);
        renderStudentsTable();
        renderDashboard();
    }
}

function handleAttendance(event) {
    const barcode = event.target.value.trim();
    if (barcode === '') return;

    const students = DB.getStudents();
    const student = students.find(s => s.id === barcode);
    const feedbackEl = document.getElementById('attendance-feedback');

    if (student) {
        feedbackEl.innerHTML = `
            <div class="alert alert-success">
                <strong>Ø­Ø¶ÙˆØ±:</strong> ${student.name} (${student.stage})
                <br>
                <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${new Date().toLocaleTimeString()}
            </div>`;
    } else {
        feedbackEl.innerHTML = `<div class="alert alert-danger"><strong>Ø®Ø·Ø£:</strong> Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…Ø³Ø¬Ù„.</div>`;
    }
    
    // Clear input for next scan
    setTimeout(() => {
        event.target.value = '';
        feedbackEl.innerHTML = '';
    }, 3000);
}

function addPayment(event) {
    event.preventDefault();
    const studentId = document.getElementById('payment-student-id').value;
    const amount = parseFloat(document.getElementById('payment-amount').value);
    
    const students = DB.getStudents();
    const student = students.find(s => s.id === studentId);

    if (!student) {
        alert('Ø®Ø·Ø£: ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
        return;
    }

    const newPayment = {
        studentId: student.id,
        studentName: student.name,
        amount,
        date: new Date().toISOString()
    };
    
    const payments = DB.getPayments();
    payments.push(newPayment);
    DB.savePayments(payments);
    
    // Show and prepare receipt
    const receiptContent = `
        <h5>Ù…Ø±ÙƒØ² Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠ</h5>
        <p>-------------------------</p>
        <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${new Date(newPayment.date).toLocaleString('ar-EG')}</p>
        <p><strong>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${newPayment.studentName}</p>
        <p><strong>ÙƒÙˆØ¯ Ø§Ù„Ø·Ø§Ù„Ø¨:</strong> ${newPayment.studentId}</p>
        <p>-------------------------</p>
        <h4>Ø§Ù„Ù…Ø¨Ù„Øº: ${newPayment.amount.toFixed(2)} Ø¬Ù†ÙŠÙ‡</h4>
        <p>-------------------------</p>
        <p>Ø´ÙƒØ±Ù‹Ø§ Ù„ÙƒÙ…!</p>
    `;
    document.getElementById('receipt-modal-content').innerHTML = receiptContent;
    const receiptModal = new bootstrap.Modal(document.getElementById('receiptModal'));
    receiptModal.show();
    
    document.getElementById('add-payment-form').reset();
    renderDashboard();
}

// =================================================================
// EVENT LISTENERS (Initial Setup)
// =================================================================
document.addEventListener('DOMContentLoaded', () => {
    // Show default page
    showPage('dashboard');

    // Attach event listeners
    document.getElementById('add-student-form').addEventListener('submit', addStudent);
    document.getElementById('search-student').addEventListener('keyup', (e) => renderStudentsTable(e.target.value));
    document.getElementById('barcode-input').addEventListener('change', handleAttendance);
    document.getElementById('add-payment-form').addEventListener('submit', addPayment);
});
</script>

</body>
</html>
