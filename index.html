<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูุธุงู ุฅุฏุงุฑุฉ ุงููุฑูุฒ ุงูุชุนูููู</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">
    
    <style>
        body {
            background-color: #f8f9fa;
        }
        .main-content .page {
            display: none; /* Hide all pages by default */
        }
        .main-content .page.active {
            display: block; /* Show only the active page */
        }
        .sidebar {
            height: 100vh;
            position: sticky;
            top: 0;
            background-color: #343a40;
            color: white;
        }
        .sidebar .nav-link {
            color: #adb5bd;
            cursor: pointer;
        }
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            color: white;
            background-color: #495057;
        }
        .stat-card {
            border: none;
            border-radius: 0.5rem;
            color: white;
        }
        .card-icon {
            font-size: 3rem;
            opacity: 0.7;
        }
        #receipt-modal-content {
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="row">
        <nav id="sidebar" class="col-md-3 col-lg-2 d-md-block sidebar p-3">
            <h4 class="text-center mb-4">ุฅุฏุงุฑุฉ ุงููุฑูุฒ</h4>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" onclick="showPage('dashboard')">๐ ููุญุฉ ุงูุชุญูู</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('students')">๐งโ๐ ุดุคูู ุงูุทูุงุจ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('attendance')">โ ุงูุญุถูุฑ ูุงูุบูุงุจ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" onclick="showPage('finance')">๐ต ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ</a>
                </li>
                 <li class="nav-item">
                    <a class="nav-link text-danger" onclick="clearData()">๐๏ธ ูุณุญ ูู ุงูุจูุงูุงุช</a>
                </li>
            </ul>
        </nav>

        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 pt-4 main-content">
            
            <div id="dashboard" class="page active">
                <h3>ููุญุฉ ุงูุชุญูู</h3>
                <div class="row mt-4">
                    <div class="col-md-4">
                        <div class="card stat-card bg-primary p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>ุฅุฌูุงูู ุงูุทูุงุจ</h5>
                                    <h2 id="total-students-stat">0</h2>
                                </div>
                                <div class="card-icon">๐งโ๐</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card bg-success p-3 mb-3">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h5>ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช</h5>
                                    <h2 id="total-revenue-stat">0</h2>
                                </div>
                                <div class="card-icon">๐ต</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="students" class="page">
                <h3>ุฅุฏุงุฑุฉ ุงูุทูุงุจ</h3>
                <div class="card p-3 mb-4">
                    <h5>ุฅุถุงูุฉ ุทุงูุจ ุฌุฏูุฏ</h5>
                    <form id="add-student-form">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="name" class="form-label">ุงุณู ุงูุทุงูุจ</label>
                                <input type="text" id="name" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="stage" class="form-label">ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ</label>
                                <input type="text" id="stage" class="form-control" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="parentPhone" class="form-label">ูุงุชู ููู ุงูุฃูุฑ</label>
                                <input type="tel" id="parentPhone" class="form-control" required>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">ุฅุถุงูุฉ ุงูุทุงูุจ</button>
                    </form>
                </div>
                <div class="card p-3">
                    <h5>ูุงุฆูุฉ ุงูุทูุงุจ</h5>
                    <input type="text" id="search-student" class="form-control mb-3" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงูููุฏ...">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>ุงูุงุณู</th>
                                <th>ุงูููุฏ (ููุจุงุฑููุฏ)</th>
                                <th>ุงููุฑุญูุฉ</th>
                                <th>ูุงุชู ููู ุงูุฃูุฑ</th>
                                <th>ุฅุฌุฑุงุกุงุช</th>
                            </tr>
                        </thead>
                        <tbody id="students-table-body">
                           </tbody>
                    </table>
                </div>
            </div>

            <div id="attendance" class="page">
                <h3>ุชุณุฌูู ุงูุญุถูุฑ (ุจุงุณุชุฎุฏุงู ูุงุฑุฆ ุงูุจุงุฑููุฏ)</h3>
                <div class="card p-3">
                    <p>ูู ุจุชูุฌูู ูุงุฑุฆ ุงูุจุงุฑููุฏ ูุญู ุญูู ุงูุฅุฏุฎุงู ุฃุฏูุงู. ุณูุชู ุชุณุฌูู ุงูุญุถูุฑ ุชููุงุฆูุงู.</p>
                    <input type="text" id="barcode-input" class="form-control form-control-lg" placeholder="ูู ุงูุชุธุงุฑ ูุฑุงุกุฉ ุงูุจุงุฑููุฏ...">
                    <div id="attendance-feedback" class="mt-3"></div>
                </div>
            </div>

            <div id="finance" class="page">
                <h3>ุงูุฅุฏุงุฑุฉ ุงููุงููุฉ</h3>
                <div class="card p-3">
                     <h5>ุชุณุฌูู ุฏูุนุฉ ุฌุฏูุฏุฉ</h5>
                     <form id="add-payment-form">
                         <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="payment-student-id" class="form-label">ููุฏ ุงูุทุงูุจ</label>
                                <input type="text" class="form-control" id="payment-student-id" required>
                            </div>
                             <div class="col-md-6 mb-3">
                                <label for="payment-amount" class="form-label">ุงููุจูุบ ุงููุฏููุน</label>
                                <input type="number" class="form-control" id="payment-amount" required>
                            </div>
                         </div>
                         <button type="submit" class="btn btn-success">ุชุณุฌูู ูุทุจุงุนุฉ ุงูุฅูุตุงู</button>
                     </form>
                </div>
            </div>

        </main>
    </div>
</div>

<div class="modal fade" id="receiptModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">ุฅูุตุงู ุงุณุชูุงู</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="receipt-modal-content">
        </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ุฅุบูุงู</button>
        <button type="button" class="btn btn-primary" onclick="window.print()">ุทุจุงุนุฉ</button>
      </div>
    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// =================================================================
// DATABASE SIMULATION (using browser's localStorage)
// =================================================================
const DB = {
    // Load data from localStorage or initialize if not present
    getStudents: () => JSON.parse(localStorage.getItem('students') || '[]'),
    saveStudents: (students) => localStorage.setItem('students', JSON.stringify(students)),
    getPayments: () => JSON.parse(localStorage.getItem('payments') || '[]'),
    savePayments: (payments) => localStorage.setItem('payments', JSON.stringify(payments)),
};

// =================================================================
// UI (User Interface) LOGIC
// =================================================================
function showPage(pageId) {
    // Hide all pages
    document.querySelectorAll('.main-content .page').forEach(page => {
        page.style.display = 'none';
    });
    // Show the requested page
    document.getElementById(pageId).style.display = 'block';

    // Update active link in sidebar
     document.querySelectorAll('.sidebar .nav-link').forEach(link => {
        link.classList.remove('active');
    });
    document.querySelector(`.sidebar .nav-link[onclick="showPage('${pageId}')"]`).classList.add('active');
    
    // Refresh data when showing a page
    if (pageId === 'students') renderStudentsTable();
    if (pageId === 'dashboard') renderDashboard();
}

function renderDashboard() {
    const students = DB.getStudents();
    const payments = DB.getPayments();
    
    document.getElementById('total-students-stat').innerText = students.length;
    
    const totalRevenue = payments.reduce((sum, payment) => sum + payment.amount, 0);
    document.getElementById('total-revenue-stat').innerText = `${totalRevenue} ุฌููู`;
}

function renderStudentsTable(filter = '') {
    const students = DB.getStudents();
    const tableBody = document.getElementById('students-table-body');
    tableBody.innerHTML = ''; // Clear existing table
    
    const filteredStudents = students.filter(student => 
        student.name.toLowerCase().includes(filter.toLowerCase()) || 
        student.id.toLowerCase().includes(filter.toLowerCase())
    );

    if (filteredStudents.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5" class="text-center">ูุง ููุฌุฏ ุทูุงุจ ูุณุฌููู.</td></tr>';
        return;
    }

    filteredStudents.forEach(student => {
        const row = `
            <tr>
                <td>${student.name}</td>
                <td>${student.id}</td>
                <td>${student.stage}</td>
                <td>${student.parentPhone}</td>
                <td>
                    <button class="btn btn-danger btn-sm" onclick="deleteStudent('${student.id}')">ุญุฐู</button>
                </td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}

function clearData() {
    if (confirm('ุชุญุฐูุฑ! ูู ุฃูุช ูุชุฃูุฏ ูู ุฑุบุจุชู ูู ูุณุญ ุฌููุน ุจูุงูุงุช ุงูุทูุงุจ ูุงูุจูุงูุงุช ุงููุงููุฉุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.')) {
        localStorage.removeItem('students');
        localStorage.removeItem('payments');
        alert('ุชู ูุณุญ ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ.');
        renderDashboard();
        renderStudentsTable();
    }
}

// =================================================================
// BUSINESS LOGIC
// =================================================================
function addStudent(event) {
    event.preventDefault();
    const name = document.getElementById('name').value;
    const stage = document.getElementById('stage').value;
    const parentPhone = document.getElementById('parentPhone').value;

    // Create a unique ID for student (serves as barcode)
    const studentId = `STU-${Date.now()}`;

    const newStudent = {
        id: studentId,
        name,
        stage,
        parentPhone
    };

    const students = DB.getStudents();
    students.push(newStudent);
    DB.saveStudents(students);

    alert(`ุชูุช ุฅุถุงูุฉ ุงูุทุงูุจ ุจูุฌุงุญ! ููุฏ ุงูุทุงูุจ (ููุจุงุฑููุฏ) ูู: ${studentId}`);
    document.getElementById('add-student-form').reset();
    renderStudentsTable();
    renderDashboard();
}

function deleteStudent(studentId) {
    if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุงูุทุงูุจ ุตุงุญุจ ุงูููุฏ ${studentId}ุ`)) {
        let students = DB.getStudents();
        students = students.filter(student => student.id !== studentId);
        DB.saveStudents(students);
        renderStudentsTable();
        renderDashboard();
    }
}

function handleAttendance(event) {
    const barcode = event.target.value.trim();
    if (barcode === '') return;

    const students = DB.getStudents();
    const student = students.find(s => s.id === barcode);
    const feedbackEl = document.getElementById('attendance-feedback');

    if (student) {
        feedbackEl.innerHTML = `
            <div class="alert alert-success">
                <strong>ุญุถูุฑ:</strong> ${student.name} (${student.stage})
                <br>
                <strong>ุงูููุช:</strong> ${new Date().toLocaleTimeString()}
            </div>`;
    } else {
        feedbackEl.innerHTML = `<div class="alert alert-danger"><strong>ุฎุทุฃ:</strong> ุงูุทุงูุจ ุบูุฑ ูุณุฌู.</div>`;
    }
    
    // Clear input for next scan
    setTimeout(() => {
        event.target.value = '';
        feedbackEl.innerHTML = '';
    }, 3000);
}

function addPayment(event) {
    event.preventDefault();
    const studentId = document.getElementById('payment-student-id').value;
    const amount = parseFloat(document.getElementById('payment-amount').value);
    
    const students = DB.getStudents();
    const student = students.find(s => s.id === studentId);

    if (!student) {
        alert('ุฎุทุฃ: ููุฏ ุงูุทุงูุจ ุบูุฑ ููุฌูุฏ.');
        return;
    }

    const newPayment = {
        studentId: student.id,
        studentName: student.name,
        amount,
        date: new Date().toISOString()
    };
    
    const payments = DB.getPayments();
    payments.push(newPayment);
    DB.savePayments(payments);
    
    // Show and prepare receipt
    const receiptContent = `
        <h5>ูุฑูุฒ ุงูุฃูุงุฆู ุงูุชุนูููู</h5>
        <p>-------------------------</p>
        <p><strong>ุงูุชุงุฑูุฎ:</strong> ${new Date(newPayment.date).toLocaleString('ar-EG')}</p>
        <p><strong>ุงุณู ุงูุทุงูุจ:</strong> ${newPayment.studentName}</p>
        <p><strong>ููุฏ ุงูุทุงูุจ:</strong> ${newPayment.studentId}</p>
        <p>-------------------------</p>
        <h4>ุงููุจูุบ: ${newPayment.amount.toFixed(2)} ุฌููู</h4>
        <p>-------------------------</p>
        <p>ุดูุฑูุง ููู!</p>
    `;
    document.getElementById('receipt-modal-content').innerHTML = receiptContent;
    const receiptModal = new bootstrap.Modal(document.getElementById('receiptModal'));
    receiptModal.show();
    
    document.getElementById('add-payment-form').reset();
    renderDashboard();
}

// =================================================================
// EVENT LISTENERS (Initial Setup)
// =================================================================
document.addEventListener('DOMContentLoaded', () => {
    // Show default page
    showPage('dashboard');

    // Attach event listeners
    document.getElementById('add-student-form').addEventListener('submit', addStudent);
    document.getElementById('search-student').addEventListener('keyup', (e) => renderStudentsTable(e.target.value));
    document.getElementById('barcode-input').addEventListener('change', handleAttendance);
    document.getElementById('add-payment-form').addEventListener('submit', addPayment);
});
</script>

</body>
</html>
